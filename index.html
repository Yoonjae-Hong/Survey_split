<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Housing Survey & Floorplan Design</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
      background: #f5f5f7;
      overflow: hidden;
      height: 100vh;
    }

    .main-container {
      display: flex;
      height: 100vh;
    }

    /* Survey Panel - 35% */
    .survey-panel {
      width: 35%;
      flex-shrink: 0;
      overflow-y: auto;
      background: #fff;
      border-right: 2px solid #ddd;
    }

    .survey-content {
      padding: 30px 20px;
    }

    .survey-header {
      background: #6c3fb5;
      color: white;
      padding: 20px;
      border-radius: 8px 8px 0 0;
    }

    .survey-header h1 {
      font-size: 20px;
      line-height: 1.3;
    }

    .survey-description {
      background: white;
      padding: 16px;
      border-radius: 0 0 8px 8px;
      margin-bottom: 16px;
      border: 1px solid #ddd;
      font-size: 11px;
      line-height: 1.5;
      color: #333;
    }

    .section {
      background: white;
      padding: 16px;
      margin-bottom: 12px;
      border-radius: 8px;
      border: 1px solid #ddd;
    }

    .section-title {
      font-size: 15px;
      font-weight: 600;
      color: #202124;
      margin-bottom: 8px;
    }

    .section-description {
      color: #5f6368;
      margin-bottom: 12px;
      font-size: 11px;
      line-height: 1.4;
    }

    .question {
      margin-bottom: 16px;
    }

    .question:last-child {
      margin-bottom: 0;
    }

    .question-title {
      font-size: 12px;
      color: #202124;
      margin-bottom: 8px;
      line-height: 1.3;
    }

    .required {
      color: #d93025;
      margin-left: 2px;
    }

    input[type="text"],
    textarea,
    select {
      width: 100%;
      padding: 7px;
      border: 1px solid #dadce0;
      border-radius: 4px;
      font-size: 11px;
      font-family: inherit;
    }

    input[type="text"]:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: #6c3fb5;
      border-width: 2px;
      padding: 6px;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
    }

    .radio-group,
    .checkbox-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .radio-option,
    .checkbox-option {
      display: flex;
      align-items: flex-start;
      gap: 6px;
    }

    input[type="radio"],
    input[type="checkbox"] {
      width: 14px;
      height: 14px;
      cursor: pointer;
      margin-top: 1px;
      flex-shrink: 0;
    }

    label {
      cursor: pointer;
      font-size: 11px;
      color: #202124;
      line-height: 1.3;
    }

    .submit-btn {
      background: #6c3fb5;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      width: 100%;
    }

    .submit-btn:hover {
      background: #5b33a1;
    }

    /* Tool Panel - 65% */
    .tool-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: #f5f5f7;
    }

    .tool-header {
      padding: 14px 20px;
      background: #fff;
      border-bottom: 1px solid #ddd;
    }

    .tool-header-title {
      font-size: 18px;
      font-weight: 600;
    }

    .tool-main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 12px;
      gap: 12px;
      overflow: hidden;
    }

    .tool-top-section {
      display: grid;
      grid-template-columns: 220px 1fr;
      gap: 12px;
      flex: 1;
      min-height: 0;
    }

    .tool-panel-left {
      background: #fff;
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      overflow-y: auto;
    }

    .tool-panel-left h3 {
      margin: 0 0 10px 0;
      font-size: 14px;
    }

    .tool-panel-left label {
      display: block;
      font-size: 11px;
      margin-bottom: 4px;
      font-weight: 500;
    }

    .tool-panel-left select,
    .tool-panel-left input[type="number"],
    .tool-panel-left input[type="text"] {
      width: 100%;
      padding: 6px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 11px;
    }

    .tool-panel-right {
      background: #fff;
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 0;
    }

    .instruction-bar {
      font-size: 11px;
      color: #555;
      background: #e8f4f8;
      padding: 10px 12px;
      border-radius: 6px;
      border: 1px solid #90caf9;
      line-height: 1.4;
    }

    .canvas {
      position: relative;
      flex: 1;
      min-height: 350px;
      border: 2px solid #ccc;
      border-radius: 6px;
      background: white;
      overflow: hidden;
    }

    .canvas-grid {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        linear-gradient(#e0e0e0 1px, transparent 1px),
        linear-gradient(90deg, #e0e0e0 1px, transparent 1px);
      background-size: 15px 15px;
      pointer-events: none;
      z-index: 1;
    }

    .canvas-content {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
    }

    .notes-section {
      background: #fff;
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      height: 160px;
      display: flex;
      flex-direction: column;
    }

    .notes-section h3 {
      font-size: 14px;
      margin-bottom: 8px;
      color: #202124;
    }

    .notes-section textarea {
      flex: 1;
      width: 100%;
      padding: 10px;
      border: 1px solid #dadce0;
      border-radius: 6px;
      font-size: 11px;
      font-family: inherit;
      resize: none;
      line-height: 1.4;
    }

    .notes-section textarea:focus {
      outline: none;
      border-color: #2563eb;
      border-width: 2px;
      padding: 9px;
    }

    .compass {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: rgba(255,255,255,0.95);
      border: 2px solid #555;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
      z-index: 20;
    }

    .compass div {
      position: absolute;
      font-weight: 700;
      font-size: 13px;
      color: #333;
    }

    .north { top: 3px; left: 50%; transform: translateX(-50%); }
    .east { right: 4px; top: 50%; transform: translateY(-50%); }
    .south { bottom: 3px; left: 50%; transform: translateX(-50%); }
    .west { left: 4px; top: 50%; transform: translateY(-50%); }

    .person-icon {
      position: absolute;
      width: 30px;
      height: 40px;
      cursor: move;
      z-index: 18;
      user-select: none;
    }

    .canvas-shape {
      position: absolute;
      border: 2px solid rgba(0,0,0,0.4);
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 10px;
      font-weight: 500;
      cursor: move;
      user-select: none;
      padding: 3px;
      text-align: center;
      word-wrap: break-word;
      border-radius: 3px;
    }

    .canvas-shape.selected {
      box-shadow: 0 0 0 3px #2563eb;
    }

    .btn {
      padding: 8px 12px;
      border-radius: 5px;
      font-size: 11px;
      font-weight: 500;
      cursor: pointer;
      border: 1px solid #dadce0;
      background: #fff;
      width: 100%;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #2563eb;
      color: white;
      border-color: #2563eb;
      margin-top: 6px;
    }

    .btn-primary:hover {
      background: #1d4ed8;
    }

    .btn:hover {
      background: #f5f5f5;
    }

    .btn-danger {
      background: #dc2626;
      color: white;
      border-color: #dc2626;
    }

    .btn-danger:hover {
      background: #b91c1c;
    }

    hr {
      margin: 12px 0;
      border: none;
      border-top: 1px solid #e0e0e0;
    }
  </style>
</head>
<body>

<div class="main-container">
  <!-- LEFT: Survey Panel -->
  <div class="survey-panel">
    <div class="survey-content">
      <div class="survey-header">
        <h1>Survey on Housing Needs and Ideal Floor Plan Design</h1>
      </div>

      <div class="survey-description">
        <p>This study aims to explore how people describe their ideal home layout and how these preferences can be represented through spatial design. Your responses‚Äîincluding textual descriptions and a simple drag-and-drop floor-plan task‚Äîwill help us better understand individual housing needs and spatial reasoning. 

The survey includes several sections covering:
<ul>
<li>Basic background information</li>
<li>Your housing preferences</li>
<li>A detailed description of your ideal one-story home</li>
<li>A floor-plan creation task using an external design tool</li>
<ul>
Please answer each question sincerely and thoughtfully. There are no right or wrong answers‚Äîonly your personal preferences. The entire survey will take approximately 20-25 minutes.
<ul>
All responses will remain anonymous. No personally identifiable information will be collected. The data will be used solely for academic research. If you have any questions about the study, please feel free to contact the researcher
<ul>
By clicking Next, you agree to participate in this research voluntarily.</p>
        <br>
        <p><strong>Contact:</strong> Yoonjae Hong, KAIST IBD Lab. (ghdjojo6@kaist.ac.kr)</p>
      </div>

      <form id="surveyForm">

        <!-- Housing Information Section -->
        <div class="section">
          <div class="section-title">Housing Information</div>

          <div class="question">
            <div class="question-title">How many people are in your household? <span class="required">*</span></div>
            <div class="radio-group">
              <div class="radio-option"><input type="radio" name="household" value="1" required><label>1 person</label></div>
              <div class="radio-option"><input type="radio" name="household" value="2"><label>2 people</label></div>
              <div class="radio-option"><input type="radio" name="household" value="3"><label>3 people</label></div>
              <div class="radio-option"><input type="radio" name="household" value="4"><label>4 people</label></div>
              <div class="radio-option"><input type="radio" name="household" value="5+"><label>5+ people</label></div>
            </div>
          </div>

          <div class="question">
            <div class="question-title">Current city of residence? <span class="required">*</span></div>
            <input type="text" name="city" required placeholder="e.g., London">
          </div>

          <div class="question">
            <div class="question-title">Monthly rent? <span class="required">*</span></div>
            <div class="radio-group">
              <div class="radio-option"><input type="radio" name="rent" value="<500" required><label>Less than ¬£500</label></div>
              <div class="radio-option"><input type="radio" name="rent" value="500-999"><label>¬£500~¬£999</label></div>
              <div class="radio-option"><input type="radio" name="rent" value="1000-1499"><label>¬£1,000~¬£1,499</label></div>
              <div class="radio-option"><input type="radio" name="rent" value="1500-1999"><label>¬£1,500~¬£1,999</label></div>
              <div class="radio-option"><input type="radio" name="rent" value="2000+"><label>¬£2,000+</label></div>
            </div>
          </div>

          <div class="question">
            <div class="question-title">Current home floor space? <span class="required">*</span></div>
            <div class="radio-group">
              <div class="radio-option"><input type="radio" name="current_space" value="<40" required><label>&lt;40„é° (&lt;430ft¬≤)</label></div>
              <div class="radio-option"><input type="radio" name="current_space" value="40-79"><label>40‚Äì79„é° (430‚Äì850ft¬≤)</label></div>
              <div class="radio-option"><input type="radio" name="current_space" value="80-119"><label>80‚Äì119„é° (860‚Äì1,280ft¬≤)</label></div>
              <div class="radio-option"><input type="radio" name="current_space" value="120+"><label>120+„é° (1,290+ft¬≤)</label></div>
            </div>
          </div>

          <div class="question">
            <div class="question-title">Ideal home floor area? <span class="required">*</span></div>
            <div class="radio-group">
              <div class="radio-option"><input type="radio" name="ideal_space" value="<40" required><label>&lt;40„é° (&lt;431ft¬≤)</label></div>
              <div class="radio-option"><input type="radio" name="ideal_space" value="40-79"><label>40‚Äì79„é° (431‚Äì850ft¬≤)</label></div>
              <div class="radio-option"><input type="radio" name="ideal_space" value="80-119"><label>80‚Äì119„é° (861‚Äì1,281ft¬≤)</label></div>
              <div class="radio-option"><input type="radio" name="ideal_space" value="120+"><label>120+„é° (1,292+ft¬≤)</label></div>
            </div>
          </div>
        </div>

        <!-- Room Type Section -->
        <div class="section">
          <div class="section-title">Room Type</div>

          <div class="question">
            <div class="question-title">Necessary room types? <span class="required">*</span></div>
            <div class="checkbox-group">
              <div class="checkbox-option"><input type="checkbox" name="room_types" value="Living Room"><label>Living Room</label></div>
              <div class="checkbox-option"><input type="checkbox" name="room_types" value="Kitchen"><label>Kitchen</label></div>
              <div class="checkbox-option"><input type="checkbox" name="room_types" value="Dining Room"><label>Dining Room</label></div>
              <div class="checkbox-option"><input type="checkbox" name="room_types" value="Master Bedroom"><label>Master Bedroom</label></div>
              <div class="checkbox-option"><input type="checkbox" name="room_types" value="Guest Bedroom"><label>Guest Bedroom</label></div>
              <div class="checkbox-option"><input type="checkbox" name="room_types" value="Bathroom"><label>Bathroom</label></div>
              <div class="checkbox-option"><input type="checkbox" name="room_types" value="Storage"><label>Storage</label></div>
            </div>
          </div>
        </div>

        <!-- File Upload Section -->
        <div class="section">
          <div class="section-title">Floor Plan Files</div>
          <div class="section-description">Upload the three files you saved from the design tool (JSON, PNG, TXT)</div>

          <div class="question">
            <div class="question-title">Upload JSON file <span class="required">*</span></div>
            <input type="file" name="json_file" accept=".json" required>
          </div>

          <div class="question">
            <div class="question-title">Upload PNG image file <span class="required">*</span></div>
            <input type="file" name="png_file" accept=".png" required>
          </div>

          <div class="question">
            <div class="question-title">Upload TXT notes file <span class="required">*</span></div>
            <input type="file" name="txt_file" accept=".txt" required>
          </div>
        </div>

        <!-- Submit Button -->
        <div class="section">
          <button type="submit" class="submit-btn">Submit Survey</button>
        </div>
      </form>
    </div>
  </div>

  <!-- RIGHT: Floorplan Tool Panel -->
  <div class="tool-panel">
    <header class="tool-header">
      <div class="tool-header-title">üè† Floorplan Design Tool</div>
    </header>

    <main class="tool-main">
      <div class="tool-top-section">
        <!-- LEFT PANEL -->
        <section class="tool-panel-left">
          <h3>Create Room</h3>

          <label>Room Type</label>
          <select id="customRoomType">
            <option>Living Room</option>
            <option>Kitchen</option>
            <option>Dining Room</option>
            <option>Master Bedroom</option>
            <option>Guest Bedroom</option>
            <option>Bathroom</option>
            <option>Storage</option>
            <option value="Others">Others</option>
          </select>

          <div id="labelContainer" style="display:none;">
            <label>Custom Label</label>
            <input id="customLabelInput" type="text" placeholder="Enter name">
          </div>

          <label>Width (1 unit = 1m)</label>
          <input id="customWidth" type="number" min="1" value="10">

          <label>Length (1 unit = 1m)</label>
          <input id="customHeight" type="number" min="1" value="8">

          <button id="addCustomRoomBtn" class="btn btn-primary">‚ûï Add Room</button>

          <hr>
          
          <button id="clearCanvasBtn" class="btn btn-danger">üóëÔ∏è Clear All</button>
          <button id="exportAllBtn" class="btn btn-primary">üíæ Save All Files</button>
        </section>

        <!-- RIGHT PANEL -->
        <section class="tool-panel-right">
          <div class="instruction-bar">
            <b>üìù Instructions:</b> Select room type, enter size, click "Add Room". Drag to arrange. Press <b>Delete</b> to remove. Click <b>"Save All Files"</b> to download JSON, PNG, and TXT.
          </div>

          <div class="canvas" id="canvas">
            <div class="canvas-grid"></div>
            <div class="canvas-content" id="canvasContent">
              <!-- Compass -->
              <div class="compass" id="compass">
                <div class="north">N</div>
                <div class="east">E</div>
                <div class="south">S</div>
                <div class="west">W</div>
              </div>

              <!-- Person icon -->
              <img id="personIcon" class="person-icon"
                src="https://raw.githubusercontent.com/Yoonjae-Hong/Survey_ver2/76437d43f2a49ee041422c151b7c6ec6c5576320/Assets/person.png"
                alt="Person">
            </div>
          </div>
        </section>
      </div>

      <!-- NOTES SECTION (Bottom) -->
      <section class="notes-section">
        <h3>üìã Design Notes</h3>
        <textarea id="notesTextarea" placeholder="Describe your floor plan design: room arrangements, sizes, adjacencies, orientations... (150‚Äì250 words)"></textarea>
      </section>
    </main>
  </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
// Google Drive upload configuration
const GOOGLE_DRIVE_FOLDER_ID = '1BopZWc7k9ytfKIqMp8MTCPvJ7cICCA3q';
const GOOGLE_API_KEY = 'YOUR_GOOGLE_API_KEY'; // You need to set this up

// Floorplan Tool Logic
const GRID_SIZE = 15;
const M_PER_UNIT = 1; // 1 grid unit = 1 meter

const ROOM_COLORS = {
  "Living Room":    "rgba(59,130,246,0.3)",
  "Kitchen":        "rgba(34,197,94,0.3)",
  "Dining Room":    "rgba(14,165,233,0.3)",
  "Master Bedroom": "rgba(139,92,246,0.3)",
  "Guest Bedroom":  "rgba(168,85,247,0.3)",
  "Bathroom":       "rgba(239,68,68,0.3)",
  "Storage":        "rgba(251,191,36,0.3)",
  "Others":         "rgba(107,114,128,0.3)"
};

const canvas = document.getElementById("canvas");
const canvasContent = document.getElementById("canvasContent");
const compass = document.getElementById("compass");
const personIcon = document.getElementById("personIcon");
const typeSelect = document.getElementById("customRoomType");
const labelContainer = document.getElementById("labelContainer");
const notesTextarea = document.getElementById("notesTextarea");

let shapes = [];
let selectedId = null;
let shapeIdCounter = 1;
let layoutJSON = [];

window.onload = () => {
  placePersonIcon();
};

function placePersonIcon() {
  const rect = canvas.getBoundingClientRect();
  
  // Place person in the center of canvas
  let left = (rect.width / 2) - 15;
  let top = (rect.height / 2) - 20;

  left = Math.round(left / GRID_SIZE) * GRID_SIZE;
  top = Math.round(top / GRID_SIZE) * GRID_SIZE;

  personIcon.style.left = left + "px";
  personIcon.style.top = top + "px";

  shapes.push({
    id: "person",
    roomType: "Person",
    x: left, y: top,
    width: 30, height: 40,
    isPerson: true
  });

  attachMove(personIcon);
}

typeSelect.addEventListener("change", () => {
  labelContainer.style.display = (typeSelect.value === "Others") ? "block" : "none";
});

document.getElementById("addCustomRoomBtn").addEventListener("click", () => {
  const type = typeSelect.value;
  const wUnits = +document.getElementById("customWidth").value;
  const hUnits = +document.getElementById("customHeight").value;

  if (wUnits <= 0 || hUnits <= 0) {
    alert("‚ö†Ô∏è Please enter valid dimensions (greater than 0)");
    return;
  }

  const w = wUnits * GRID_SIZE;
  const h = hUnits * GRID_SIZE;

  let label = type;
  if (type === "Others") {
    label = document.getElementById("customLabelInput").value.trim();
    if (!label) {
      alert("‚ö†Ô∏è Please enter a custom label");
      return;
    }
  }

  const rect = canvas.getBoundingClientRect();
  const x = Math.round((rect.width/2 - w/2)/GRID_SIZE) * GRID_SIZE;
  const y = Math.round((rect.height/2 - h/2)/GRID_SIZE) * GRID_SIZE;

  addShape({ roomType:type, label:`${label} (${wUnits}√ó${hUnits})`, x, y, width:w, height:h });
});

function addShape({ roomType, label, x, y, width, height }) {
  const id = "shape_" + shapeIdCounter++;

  const div = document.createElement("div");
  div.className = "canvas-shape";
  div.dataset.id = id;
  div.style.left = x+"px";
  div.style.top = y+"px";
  div.style.width = width+"px";
  div.style.height = height+"px";
  div.style.background = ROOM_COLORS[roomType] || "rgba(59,130,246,0.3)";
  div.textContent = label;

  canvasContent.appendChild(div);
  shapes.push({ id, roomType, label, x, y, width, height });

  attachMove(div);
  updateJSON();
}

function attachMove(el) {
  el.addEventListener("mousedown", e => {
    e.preventDefault();
    selectedId = el.dataset ? el.dataset.id : el.id;

    document.querySelectorAll('.canvas-shape').forEach(s => s.classList.remove('selected'));
    
    if (el.classList && el.classList.contains('canvas-shape')) {
      el.classList.add('selected');
    }

    const startX = e.clientX;
    const startY = e.clientY;
    const initX = parseFloat(el.style.left);
    const initY = parseFloat(el.style.top);

    function move(ev) {
      let nx = initX + (ev.clientX - startX);
      let ny = initY + (ev.clientY - startY);

      nx = Math.round(nx / GRID_SIZE) * GRID_SIZE;
      ny = Math.round(ny / GRID_SIZE) * GRID_SIZE;

      el.style.left = nx + "px";
      el.style.top = ny + "px";

      const s = shapes.find(o => o.id === selectedId);
      if (s) { s.x = nx; s.y = ny; }

      updateJSON();
    }

    function stop() {
      document.removeEventListener("mousemove", move);
      document.removeEventListener("mouseup", stop);
    }

    document.addEventListener("mousemove", move);
    document.addEventListener("mouseup", stop);
  });
}

document.addEventListener("keydown", e => {
  if ((e.key === "Delete" || e.key === "Backspace") && selectedId) {
    const s = shapes.find(o => o.id === selectedId);
    if (s?.isPerson) return;

    const el = canvasContent.querySelector(`[data-id="${selectedId}"]`);
    el?.remove();
    shapes = shapes.filter(o => o.id !== selectedId);
    selectedId = null;
    updateJSON();
  }
});

function updateJSON() {
  layoutJSON = shapes
    .filter(s => !s.isPerson)
    .map(s => ({
      id: s.id,
      roomType: s.roomType,
      label: s.label,
      x: (s.x / GRID_SIZE) * M_PER_UNIT * 0.6,
      y: (s.y / GRID_SIZE) * M_PER_UNIT * 0.6,
      width: (s.width / GRID_SIZE) * M_PER_UNIT * 0.6,
      height: (s.height / GRID_SIZE) * M_PER_UNIT * 0.6
    }));
}

document.getElementById("clearCanvasBtn").addEventListener("click", () => {
  if (!confirm("‚ö†Ô∏è Clear all rooms?")) return;
  shapes = shapes.filter(s => s.isPerson);
  [...canvasContent.querySelectorAll(".canvas-shape")].forEach(el => el.remove());
  updateJSON();
});

document.getElementById("exportAllBtn").addEventListener("click", async () => {
  if (layoutJSON.length === 0) {
    alert("‚ö†Ô∏è Please add at least one room before saving.");
    return;
  }

  const notesText = notesTextarea.value.trim();
  if (!notesText) {
    alert("‚ö†Ô∏è Please write design notes before saving.");
    return;
  }

  // Save JSON file
  const jsonBlob = new Blob([JSON.stringify(layoutJSON, null, 2)], { type:"application/json" });
  const jsonUrl = URL.createObjectURL(jsonBlob);
  const a1 = document.createElement("a");
  a1.href = jsonUrl;
  a1.download = "layout.json";
  a1.click();

  // Save TXT file
  const txtBlob = new Blob([notesText], { type:"text/plain" });
  const txtUrl = URL.createObjectURL(txtBlob);
  const a3 = document.createElement("a");
  a3.href = txtUrl;
  a3.download = "design_notes.txt";
  a3.click();

  // Save PNG screenshot
  const screenshot = await html2canvas(canvasContent, { backgroundColor:"#ffffff", scale:2 });
  screenshot.toBlob((imgBlob) => {
    const pngUrl = URL.createObjectURL(imgBlob);
    const a2 = document.createElement("a");
    a2.href = pngUrl;
    a2.download = "layout.png";
    a2.click();
    
    alert("‚úÖ All files saved successfully! (JSON, PNG, TXT)\n\nPlease upload these files in the survey form.");
  });
});

// Survey Form Submission with Google Drive Upload
document.getElementById('surveyForm').addEventListener('submit', async function(e) {
  e.preventDefault();
  
  // Collect form data
  const formData = new FormData(this);
  const surveyData = {};
  
  for (let [key, value] of formData.entries()) {
    if (key === 'room_types') {
      if (!surveyData[key]) surveyData[key] = [];
      surveyData[key].push(value);
    } else if (key.includes('_file')) {
      surveyData[key] = value; // File object
    } else {
      surveyData[key] = value;
    }
  }
  
  console.log("Survey Data:", surveyData);
  
  // Upload files to Google Drive
  try {
    alert("üì§ Uploading files to Google Drive...\n\nNote: Google Drive integration requires API setup.\nFor now, files are logged to console.");
    
    // In production, you would upload files here using Google Drive API
    // This requires OAuth2 authentication and API key setup
    // Example: await uploadToGoogleDrive(surveyData.json_file, surveyData.png_file, surveyData.txt_file);
    
    console.log("Files to upload:", {
      json: surveyData.json_file,
      png: surveyData.png_file,
      txt: surveyData.txt_file
    });
    
    alert('‚úÖ Survey submitted successfully!\n\nFiles would be uploaded to:\nhttps://drive.google.com/drive/folders/1BopZWc7k9ytfKIqMp8MTCPvJ7cICCA3q\n\n(Google Drive API setup required for actual upload)');
    
    // Reset form
    this.reset();
  } catch (error) {
    console.error("Upload error:", error);
    alert("‚ùå Error uploading files. Please try again.");
  }
});

// Google Drive Upload Function (requires setup)
async function uploadToGoogleDrive(jsonFile, pngFile, txtFile) {
  // This function requires:
  // 1. Google API credentials
  // 2. OAuth2 authentication
  // 3. Google Drive API enabled
  
  // Example implementation would use fetch() with proper authentication
  // const formData = new FormData();
  // formData.append('file', jsonFile);
  // const response = await fetch('https://www.googleapis.com/upload/drive/v3/files', {...});
  
  console.log("Upload function called with files:", jsonFile.name, pngFile.name, txtFile.name);
}
</script>
